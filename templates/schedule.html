{% extends "base.html" %}

{% block title %}NBA Schedule - Stat Lemon{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-md-12">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{{ url_for('index') }}">Home</a></li>
                <li class="breadcrumb-item active" aria-current="page">Schedule</li>
            </ol>
        </nav>
    </div>
</div>

<div class="row mb-4">
    <div class="col-md-12">
        <div class="card shadow-sm">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0">NBA Game Schedule</h4>
            </div>
            <div class="card-body">
                <div class="row align-items-center mb-4">
                    <div class="col-md-6">
                        <div class="input-group date" id="datepicker">
                            <input type="text" class="form-control" id="date-input" value="{{ date }}" placeholder="Select date">
                            <span class="input-group-text"><i class="fas fa-calendar"></i></span>
                        </div>
                    </div>
                    <div class="col-md-6 text-md-end mt-3 mt-md-0">
                        <button class="btn btn-outline-secondary me-2" id="prev-day-btn">
                            <i class="fas fa-chevron-left"></i> Previous Day
                        </button>
                        <button class="btn btn-outline-secondary" id="next-day-btn">
                            Next Day <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Games List -->
<div class="row mb-5">
    <div class="col-md-12">
        <div class="card shadow-sm">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0" id="schedule-date-display">Games for {{ date }}</h5>
                <span class="badge bg-primary" id="games-count">{{ games|length if games else 0 }} Games</span>
            </div>
            <div class="card-body p-0">
                <div id="games-container">
                    {% if games and games|length > 0 %}
                        <div class="table-responsive">
                            <table class="table table-hover align-middle mb-0">
                                <thead class="table-light">
                                    <tr>
                                        <th>Time</th>
                                        <th>Away Team</th>
                                        <th>Score</th>
                                        <th>Home Team</th>
                                        <th>Venue</th>
                                        <th>Prediction</th>
                                        <th class="text-center">Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for game in games %}
                                    <tr>
                                        <td>{{ game.game_time }}</td>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <div class="team-logo me-2">
                                                    <img src="{{ url_for('static', filename='img/teams/' + game.away_team|replace(' ', '')|lower + '.png') }}" width="30" height="30" alt="{{ game.away_team }}">
                                                </div>
                                                <span>{{ game.away_team }}</span>
                                            </div>
                                        </td>
                                        <td>
                                            {% if game.status == 'Final' %}
                                                <span class="score">{{ game.away_score }} - {{ game.home_score }}</span>
                                            {% elif game.status == 'In Progress' %}
                                                <span class="score text-primary">{{ game.away_score }} - {{ game.home_score }}</span>
                                                <span class="badge bg-danger">Live</span>
                                            {% else %}
                                                <span class="text-muted">-</span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <div class="team-logo me-2">
                                                    <img src="{{ url_for('static', filename='img/teams/' + game.home_team|replace(' ', '')|lower + '.png') }}" width="30" height="30" alt="{{ game.home_team }}">
                                                </div>
                                                <span>{{ game.home_team }}</span>
                                            </div>
                                        </td>
                                        <td>{{ game.venue }}</td>
                                        <td>
                                            {% if game.prediction %}
                                                <div>
                                                    <span class="fw-bold {% if game.prediction.predicted_winner == game.home_team %}text-success{% else %}text-danger{% endif %}">
                                                        {{ game.prediction.predicted_winner }}
                                                    </span>
                                                    <span class="small text-muted">
                                                        ({{ (game.prediction.win_probability * 100)|round(1) }}%)
                                                    </span>
                                                </div>
                                                <div class="small text-muted">
                                                    {{ game.prediction.predicted_home_points|round(1) }} - {{ game.prediction.predicted_away_points|round(1) }}
                                                </div>
                                            {% else %}
                                                <span class="text-muted">Not available</span>
                                            {% endif %}
                                        </td>
                                        <td class="text-center">
                                            <div class="btn-group" role="group">
                                                <a href="{{ url_for('matchup_simulator') }}?home={{ game.home_team }}&away={{ game.away_team }}" class="btn btn-sm btn-outline-primary">
                                                    <i class="fas fa-chart-bar"></i> Simulate
                                                </a>
                                                <button type="button" class="btn btn-sm btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#gameDetailsModal" data-game-id="{{ game.game_id }}">
                                                    <i class="fas fa-info-circle"></i> Details
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% else %}
                        <div class="text-center py-5">
                            <i class="fas fa-basketball-ball fa-3x text-muted mb-3"></i>
                            <h5>No games scheduled for this date</h5>
                            <p class="text-muted">Try selecting a different date or check back later.</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Team Standings Section -->
<div class="row mb-5">
    <div class="col-md-12">
        <h4 class="mb-4">NBA Standings</h4>
        <ul class="nav nav-tabs" id="standingsTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="eastern-tab" data-bs-toggle="tab" data-bs-target="#eastern" type="button" role="tab" aria-controls="eastern" aria-selected="true">Eastern Conference</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="western-tab" data-bs-toggle="tab" data-bs-target="#western" type="button" role="tab" aria-controls="western" aria-selected="false">Western Conference</button>
            </li>
        </ul>
        <div class="tab-content" id="standingsTabContent">
            <div class="tab-pane fade show active" id="eastern" role="tabpanel" aria-labelledby="eastern-tab">
                <div class="table-responsive">
                    <table class="table table-hover table-striped">
                        <thead class="table-light">
                            <tr>
                                <th>Rank</th>
                                <th>Team</th>
                                <th>W</th>
                                <th>L</th>
                                <th>PCT</th>
                                <th>GB</th>
                                <th>STRK</th>
                                <th>L10</th>
                            </tr>
                        </thead>
                        <tbody id="eastern-standings">
                            <tr>
                                <td colspan="8" class="text-center py-3">
                                    <div class="spinner-border spinner-border-sm text-primary" role="status">
                                        <span class="visually-hidden">Loading...</span>
                                    </div>
                                    <span class="ms-2">Loading standings...</span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="tab-pane fade" id="western" role="tabpanel" aria-labelledby="western-tab">
                <div class="table-responsive">
                    <table class="table table-hover table-striped">
                        <thead class="table-light">
                            <tr>
                                <th>Rank</th>
                                <th>Team</th>
                                <th>W</th>
                                <th>L</th>
                                <th>PCT</th>
                                <th>GB</th>
                                <th>STRK</th>
                                <th>L10</th>
                            </tr>
                        </thead>
                        <tbody id="western-standings">
                            <tr>
                                <td colspan="8" class="text-center py-3">
                                    <div class="spinner-border spinner-border-sm text-primary" role="status">
                                        <span class="visually-hidden">Loading...</span>
                                    </div>
                                    <span class="ms-2">Loading standings...</span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Game Details Modal -->
<div class="modal fade" id="gameDetailsModal" tabindex="-1" aria-labelledby="gameDetailsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="gameDetailsModalLabel">Game Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="gameDetailsModalBody">
                <div class="text-center py-4">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mt-2">Loading game details...</p>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <a href="#" class="btn btn-primary" id="simulateGameBtn">Simulate Matchup</a>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Sample data for Eastern Conference standings
    const easternStandings = [
        { rank: 1, team: "Boston Celtics", wins: 59, losses: 16, pct: 0.787, gb: "-", streak: "W2", last10: "8-2" },
        { rank: 2, team: "Milwaukee Bucks", wins: 49, losses: 26, pct: 0.653, gb: "10.0", streak: "W1", last10: "7-3" },
        { rank: 3, team: "Cleveland Cavaliers", wins: 46, losses: 29, pct: 0.613, gb: "13.0", streak: "L2", last10: "5-5" },
        { rank: 4, team: "New York Knicks", wins: 46, losses: 29, pct: 0.613, gb: "13.0", streak: "W2", last10: "6-4" },
        { rank: 5, team: "Orlando Magic", wins: 44, losses: 31, pct: 0.587, gb: "15.0", streak: "L1", last10: "7-3" },
        { rank: 6, team: "Indiana Pacers", wins: 43, losses: 32, pct: 0.573, gb: "16.0", streak: "W1", last10: "6-4" },
        { rank: 7, team: "Miami Heat", wins: 42, losses: 33, pct: 0.560, gb: "17.0", streak: "W2", last10: "7-3" },
        { rank: 8, team: "Philadelphia 76ers", wins: 40, losses: 35, pct: 0.533, gb: "19.0", streak: "L1", last10: "4-6" },
        { rank: 9, team: "Chicago Bulls", wins: 36, losses: 39, pct: 0.480, gb: "23.0", streak: "W3", last10: "6-4" },
        { rank: 10, team: "Atlanta Hawks", wins: 35, losses: 40, pct: 0.467, gb: "24.0", streak: "L2", last10: "5-5" }
    ];
    
    // Sample data for Western Conference standings
    const westernStandings = [
        { rank: 1, team: "Oklahoma City Thunder", wins: 52, losses: 22, pct: 0.703, gb: "-", streak: "W1", last10: "7-3" },
        { rank: 2, team: "Denver Nuggets", wins: 52, losses: 23, pct: 0.693, gb: "0.5", streak: "W3", last10: "6-4" },
        { rank: 3, team: "Minnesota Timberwolves", wins: 51, losses: 23, pct: 0.689, gb: "1.0", streak: "L1", last10: "8-2" },
        { rank: 4, team: "Los Angeles Clippers", wins: 45, losses: 29, pct: 0.608, gb: "7.0", streak: "L2", last10: "5-5" },
        { rank: 5, team: "Dallas Mavericks", wins: 45, losses: 30, pct: 0.600, gb: "7.5", streak: "W2", last10: "7-3" },
        { rank: 6, team: "Phoenix Suns", wins: 44, losses: 31, pct: 0.587, gb: "8.5", streak: "W1", last10: "6-4" },
        { rank: 7, team: "New Orleans Pelicans", wins: 45, losses: 31, pct: 0.593, gb: "8.0", streak: "L3", last10: "4-6" },
        { rank: 8, team: "Sacramento Kings", wins: 43, losses: 31, pct: 0.581, gb: "9.0", streak: "W2", last10: "7-3" },
        { rank: 9, team: "Los Angeles Lakers", wins: 42, losses: 33, pct: 0.560, gb: "10.5", streak: "W4", last10: "8-2" },
        { rank: 10, team: "Golden State Warriors", wins: 40, losses: 34, pct: 0.541, gb: "12.0", streak: "W3", last10: "7-3" }
    ];
    
    // Function to load standings data
    function loadStandings() {
        // Eastern Conference
        let easternHtml = '';
        
        easternStandings.forEach(team => {
            easternHtml += `
                <tr>
                    <td>${team.rank}</td>
                    <td>
                        <div class="d-flex align-items-center">
                            <div class="team-logo me-2">
                                <img src="/static/img/teams/${team.team.replace(/\s+/g, '').toLowerCase()}.png" width="25" height="25" alt="${team.team}">
                            </div>
                            <span>${team.team}</span>
                        </div>
                    </td>
                    <td>${team.wins}</td>
                    <td>${team.losses}</td>
                    <td>${team.pct}</td>
                    <td>${team.gb}</td>
                    <td>${team.streak}</td>
                    <td>${team.last10}</td>
                </tr>
            `;
        });
        
        $('#eastern-standings').html(easternHtml);
        
        // Western Conference
        let westernHtml = '';
        
        westernStandings.forEach(team => {
            westernHtml += `
                <tr>
                    <td>${team.rank}</td>
                    <td>
                        <div class="d-flex align-items-center">
                            <div class="team-logo me-2">
                                <img src="/static/img/teams/${team.team.replace(/\s+/g, '').toLowerCase()}.png" width="25" height="25" alt="${team.team}">
                            </div>
                            <span>${team.team}</span>
                        </div>
                    </td>
                    <td>${team.wins}</td>
                    <td>${team.losses}</td>
                    <td>${team.pct}</td>
                    <td>${team.gb}</td>
                    <td>${team.streak}</td>
                    <td>${team.last10}</td>
                </tr>
            `;
        });
        
        $('#western-standings').html(westernHtml);
    }
    
    // Function to load games for a specific date
    function loadGames(date) {
        $('#schedule-date-display').text(`Games for ${formatDate(date)}`);
        
        // Show loading indicator
        $('#games-container').html(`
            <div class="text-center py-5">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <p class="mt-3">Loading games for ${formatDate(date)}...</p>
            </div>
        `);
        
        // In a real application, this would be an API call
        // For the MVP, we'll simulate API response timing
        setTimeout(function() {
            // Check if there are games on this date (for demo purposes)
            const hasGames = Math.random() > 0.3; // 70% chance of having games
            
            if (hasGames) {
                // Generate random number of games (3-8)
                const numGames = Math.floor(Math.random() * 6) + 3;
                
                // Update games count badge
                $('#games-count').text(`${numGames} Games`);
                
                // Generate fake games
                let gamesHtml = `
                    <div class="table-responsive">
                        <table class="table table-hover align-middle mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th>Time</th>
                                    <th>Away Team</th>
                                    <th>Score</th>
                                    <th>Home Team</th>
                                    <th>Venue</th>
                                    <th>Prediction</th>
                                    <th class="text-center">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                `;
                
                // Teams for random selection
                const teams = [
                    "Boston Celtics", "Milwaukee Bucks", "Philadelphia 76ers", "Cleveland Cavaliers",
                    "New York Knicks", "Miami Heat", "Orlando Magic", "Indiana Pacers",
                    "Oklahoma City Thunder", "Denver Nuggets", "Minnesota Timberwolves", "Phoenix Suns",
                    "Los Angeles Clippers", "Dallas Mavericks", "New Orleans Pelicans", "Los Angeles Lakers"
                ];
                
                // Venues for random selection
                const venues = [
                    "TD Garden", "Fiserv Forum", "Wells Fargo Center", "Rocket Mortgage FieldHouse",
                    "Madison Square Garden", "Kaseya Center", "Kia Center", "Gainbridge Fieldhouse",
                    "Paycom Center", "Ball Arena", "Target Center", "Footprint Center",
                    "Intuit Dome", "American Airlines Center", "Smoothie King Center", "Crypto.com Arena"
                ];
                
                // Generate rows for each game
                for (let i = 0; i < numGames; i++) {
                    // Select random teams (ensure they're different)
                    let homeTeamIndex = Math.floor(Math.random() * teams.length);
                    let awayTeamIndex;
                    do {
                        awayTeamIndex = Math.floor(Math.random() * teams.length);
                    } while (awayTeamIndex === homeTeamIndex);
                    
                    const homeTeam = teams[homeTeamIndex];
                    const awayTeam = teams[awayTeamIndex];
                    const venue = venues[homeTeamIndex];
                    
                    // Generate random game time
                    const hours = Math.floor(Math.random() * 8) + 12; // 12 PM to 7 PM
                    const minutes = Math.random() > 0.5 ? "00" : "30"; // Either on the hour or half hour
                    const gameTime = `${hours}:${minutes} ${hours >= 12 ? "PM" : "AM"}`;
                    
                    // Decide game status (scheduled, in progress, or final)
                    let gameStatus, homeScore, awayScore, predictionClass;
                    
                    if (date < new Date().toISOString().split('T')[0]) {
                        // Past game - Final
                        gameStatus = "Final";
                        homeScore = Math.floor(Math.random() * 40) + 90; // 90-130
                        awayScore = Math.floor(Math.random() * 40) + 90; // 90-130
                        predictionClass = homeScore > awayScore ? "text-success" : "text-danger";
                    } else if (date === new Date().toISOString().split('T')[0] && Math.random() > 0.7) {
                        // Today's game with 30% chance of being in progress
                        gameStatus = "In Progress";
                        homeScore = Math.floor(Math.random() * 30) + 60; // 60-90 (in progress)
                        awayScore = Math.floor(Math.random() * 30) + 60; // 60-90 (in progress)
                        predictionClass = homeScore > awayScore ? "text-success" : "text-danger";
                    } else {
                        // Future game - Scheduled
                        gameStatus = "Scheduled";
                        homeScore = "-";
                        awayScore = "-";
                    }
                    
                    // Generate prediction
                    let prediction = "";
                    if (gameStatus === "Scheduled") {
                        const predictedWinner = Math.random() > 0.5 ? homeTeam : awayTeam;
                        const winProbability = (Math.random() * 30 + 50).toFixed(1); // 50-80%
                        const predictedHomePoints = (Math.random() * 20 + 100).toFixed(1); // 100-120
                        const predictedAwayPoints = (Math.random() * 20 + 100).toFixed(1); // 100-120
                        
                        prediction = `
                            <div>
                                <span class="fw-bold ${predictedWinner === homeTeam ? 'text-success' : 'text-danger'}">
                                    ${predictedWinner}
                                </span>
                                <span class="small text-muted">
                                    (${winProbability}%)
                                </span>
                            </div>
                            <div class="small text-muted">
                                ${predictedHomePoints} - ${predictedAwayPoints}
                            </div>
                        `;
                    } else {
                        prediction = `<span class="text-muted">Not available</span>`;
                    }
                    
                    // Generate score display
                    let scoreDisplay;
                    if (gameStatus === "Final") {
                        scoreDisplay = `<span class="score">${awayScore} - ${homeScore}</span>`;
                    } else if (gameStatus === "In Progress") {
                        scoreDisplay = `
                            <span class="score text-primary">${awayScore} - ${homeScore}</span>
                            <span class="badge bg-danger">Live</span>
                        `;
                    } else {
                        scoreDisplay = `<span class="text-muted">-</span>`;
                    }
                    
                    // Add game row
                    gamesHtml += `
                        <tr>
                            <td>${gameTime}</td>
                            <td>
                                <div class="d-flex align-items-center">
                                    <div class="team-logo me-2">
                                        <img src="/static/img/teams/${awayTeam.replace(/\s+/g, '').toLowerCase()}.png" width="30" height="30" alt="${awayTeam}">
                                    </div>
                                    <span>${awayTeam}</span>
                                </div>
                            </td>
                            <td>${scoreDisplay}</td>
                            <td>
                                <div class="d-flex align-items-center">
                                    <div class="team-logo me-2">
                                        <img src="/static/img/teams/${homeTeam.replace(/\s+/g, '').toLowerCase()}.png" width="30" height="30" alt="${homeTeam}">
                                    </div>
                                    <span>${homeTeam}</span>
                                </div>
                            </td>
                            <td>${venue}</td>
                            <td>${prediction}</td>
                            <td class="text-center">
                                <div class="btn-group" role="group">
                                    <a href="/matchup_simulator?home=${encodeURIComponent(homeTeam)}&away=${encodeURIComponent(awayTeam)}" class="btn btn-sm btn-outline-primary">
                                        <i class="fas fa-chart-bar"></i> Simulate
                                    </a>
                                    <button type="button" class="btn btn-sm btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#gameDetailsModal" data-home="${homeTeam}" data-away="${awayTeam}">
                                        <i class="fas fa-info-circle"></i> Details
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `;
                }
                
                gamesHtml += `
                            </tbody>
                        </table>
                    </div>
                `;
                
                $('#games-container').html(gamesHtml);
                
                // Attach click handlers to game detail buttons
                attachGameDetailHandlers();
                
            } else {
                // No games for this date
                $('#games-count').text('0 Games');
                
                $('#games-container').html(`
                    <div class="text-center py-5">
                        <i class="fas fa-basketball-ball fa-3x text-muted mb-3"></i>
                        <h5>No games scheduled for this date</h5>
                        <p class="text-muted">Try selecting a different date or check back later.</p>
                    </div>
                `);
            }
        }, 1000);
    }
    
    // Function to attach game detail handlers
    function attachGameDetailHandlers() {
        $('[data-bs-target="#gameDetailsModal"]').click(function() {
            const homeTeam = $(this).data('home');
            const awayTeam = $(this).data('away');
            
            // Update modal title
            $('#gameDetailsModalLabel').text(`${awayTeam} @ ${homeTeam}`);
            
            // Update simulate button URL
            $('#simulateGameBtn').attr('href', `/matchup_simulator?home=${encodeURIComponent(homeTeam)}&away=${encodeURIComponent(awayTeam)}`);
            
            // Show loading indicator in modal
            $('#gameDetailsModalBody').html(`
                <div class="text-center py-4">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mt-2">Loading game details...</p>
                </div>
            `);
            
            // In a real application, this would be an API call
            // For the MVP, we'll simulate API response timing
            setTimeout(function() {
                generateGameDetails(homeTeam, awayTeam);
            }, 1000);
        });
    }
    
    // Function to generate game details for modal
    function generateGameDetails(homeTeam, awayTeam) {
        // Generate home team record
        const homeWins = Math.floor(Math.random() * 20) + 30; // 30-50 wins
        const homeLosses = Math.floor(Math.random() * 20) + 20; // 20-40 losses
        
        // Generate away team record
        const awayWins = Math.floor(Math.random() * 20) + 30; // 30-50 wins
        const awayLosses = Math.floor(Math.random() * 20) + 20; // 20-40 losses
        
        // Create content
        const content = `
            <div class="row mb-4">
                <div class="col-md-5 text-center">
                    <div class="team-logo mb-3">
                        <img src="/static/img/teams/${awayTeam.replace(/\s+/g, '').toLowerCase()}.png" width="80" height="80" alt="${awayTeam}">
                    </div>
                    <h4>${awayTeam}</h4>
                    <p class="text-muted">${awayWins}-${awayLosses}</p>
                </div>
                <div class="col-md-2 d-flex align-items-center justify-content-center">
                    <div class="vs-badge d-flex align-items-center justify-content-center bg-light rounded-circle" style="width: 60px; height: 60px;">
                        <span class="fw-bold">VS</span>
                    </div>
                </div>
                <div class="col-md-5 text-center">
                    <div class="team-logo mb-3">
                        <img src="/static/img/teams/${homeTeam.replace(/\s+/g, '').toLowerCase()}.png" width="80" height="80" alt="${homeTeam}">
                    </div>
                    <h4>${homeTeam}</h4>
                    <p class="text-muted">${homeWins}-${homeLosses}</p>
                </div>
            </div>
            
            <h5>Head to Head This Season</h5>
            <div class="table-responsive mb-4">
                <table class="table table-bordered">
                    <thead class="table-light">
                        <tr>
                            <th>Date</th>
                            <th>Location</th>
                            <th>Result</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Dec 15, 2024</td>
                            <td>${awayTeam}</td>
                            <td>${awayTeam} 112 - 108 ${homeTeam}</td>
                        </tr>
                        <tr>
                            <td>Jan 23, 2025</td>
                            <td>${homeTeam}</td>
                            <td>${homeTeam} 124 - 119 ${awayTeam}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <h5>Game Prediction</h5>
            <div class="row mb-4">
                <div class="col-md-6">
                    <div class="card border-0 bg-light">
                        <div class="card-body">
                            <h6 class="card-title">Win Probability</h6>
                            <div class="progress mb-3" style="height: 25px;">
                                <div class="progress-bar bg-danger" role="progressbar" style="width: 45%;" aria-valuenow="45" aria-valuemin="0" aria-valuemax="100">45%</div>
                                <div class="progress-bar bg-success" role="progressbar" style="width: 55%;" aria-valuenow="55" aria-valuemin="0" aria-valuemax="100">55%</div>
                            </div>
                            <div class="d-flex justify-content-between">
                                <span>${awayTeam}</span>
                                <span>${homeTeam}</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card border-0 bg-light">
                        <div class="card-body">
                            <h6 class="card-title">Projected Score</h6>
                            <div class="d-flex justify-content-around align-items-center">
                                <div class="text-center">
                                    <span class="fs-2 fw-bold">112.5</span>
                                    <span class="d-block text-muted">${awayTeam}</span>
                                </div>
                                <div class="text-center">
                                    <span class="fs-2 fw-bold">116.8</span>
                                    <span class="d-block text-muted">${homeTeam}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <h5>Key Players</h5>
            <div class="row">
                <div class="col-md-6">
                    <h6>${awayTeam}</h6>
                    <ul class="list-group">
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <span>Player 1</span>
                            <span class="badge bg-primary rounded-pill">28.4 PPG</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <span>Player 2</span>
                            <span class="badge bg-primary rounded-pill">9.2 RPG</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <span>Player 3</span>
                            <span class="badge bg-primary rounded-pill">7.8 APG</span>
                        </li>
                    </ul>
                </div>
                <div class="col-md-6">
                    <h6>${homeTeam}</h6>
                    <ul class="list-group">
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <span>Player A</span>
                            <span class="badge bg-primary rounded-pill">26.2 PPG</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <span>Player B</span>
                            <span class="badge bg-primary rounded-pill">11.5 RPG</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <span>Player C</span>
                            <span class="badge bg-primary rounded-pill">8.4 APG</span>
                        </li>
                    </ul>
                </div>
            </div>
        `;
        
        // Update modal body
        $('#gameDetailsModalBody').html(content);
    }
    
    // Format date for display
    function formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString('en-US', { 
            weekday: 'long',
            year: 'numeric', 
            month: 'long', 
            day: 'numeric' 
        });
    }
    
    // Get formatted date string for specified offset from today
    function getDateString(dayOffset) {
        const date = new Date();
        date.setDate(date.getDate() + dayOffset);
        return date.toISOString().split('T')[0];
    }
    
    $(document).ready(function() {
        // Initialize datepicker
        $('#datepicker').datepicker({
            format: 'yyyy-mm-dd',
            autoclose: true,
            todayHighlight: true
        }).on('changeDate', function(e) {
            // When date changes, load games for that date
            loadGames(e.format());
        });
        
        // Handle prev/next day buttons
        $('#prev-day-btn').click(function() {
            const currentDate = $('#date-input').val();
            const date = new Date(currentDate);
            date.setDate(date.getDate() - 1);
            const newDate = date.toISOString().split('T')[0];
            
            // Update datepicker and load games
            $('#date-input').val(newDate);
            loadGames(newDate);
        });
        
        $('#next-day-btn').click(function() {
            const currentDate = $('#date-input').val();
            const date = new Date(currentDate);
            date.setDate(date.getDate() + 1);
            const newDate = date.toISOString().split('T')[0];
            
            // Update datepicker and load games
            $('#date-input').val(newDate);
            loadGames(newDate);
        });
        
        // Load standings
        loadStandings();
        
        // Load today's games on page load
        loadGames("{{ date }}");
    });
</script>
{% endblock %}